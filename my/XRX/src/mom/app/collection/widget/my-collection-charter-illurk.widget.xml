<xrx:widget xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xrx="http://www.monasterium.net/NS/xrx" xmlns:xf="http://www.w3.org/2002/xforms">
    <xrx:id>tag:www.monasterium.net,2011:/mom/widget/my-collection-charter-illurk</xrx:id>
    <xrx:title>
        <xrx:i18n>
            <xrx:key/>
            <xrx:default/>
        </xrx:i18n>
    </xrx:title>
    <xrx:subtitle/>
    <xrx:description/>
    <xrx:author>jochen.graf@uni-koeln.de</xrx:author>
    <xrx:licence>
This is a component file of the VdU Software for a Virtual Research Environment for the handling of Medieval charters.

As the source code is available here, it is somewhere between an alpha- and a beta-release, may be changed without any consideration of backward compatibility of other parts of the system, therefore, without any notice.

This file is part of the VdU Virtual Research Environment Toolkit (VdU/VRET).

The VdU/VRET is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

VdU/VRET is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with VdU/VRET.  If not, see http://www.gnu.org/licenses.

We expect VdU/VRET to be distributed in the future with a license more lenient towards the inclusion of components into other systems, once it leaves the active development stage.
  </xrx:licence>
    <xrx:variables>
        <xrx:variable>
            <xrx:name>$uuid</xrx:name>
            <xrx:expression>$xrx:tokenized-uri[2]</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$atomid</xrx:name>
            <xrx:expression>metadata:atomid('charter', $uuid)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$base-collection</xrx:name>
            <xrx:expression>if($xrx:tokenized-uri[last()] = 'edit') then metadata:base-collection('charter', 'private') else $user:db-base-collection</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$entry</xrx:name>
            <xrx:expression>if(not(exists($base-collection//atom:id[ends-with(.,$uuid)]/parent::atom:entry))) then $user:db-base-collection//atom:id[ends-with(., $uuid)]/parent::atom:entry else $base-collection//atom:id[ends-with(.,$uuid)]/parent::atom:entry</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$idno</xrx:name>
            <xrx:expression>$entry//cei:body/cei:idno/text()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$image-urls</xrx:name>
            <xrx:expression>for $url in $entry//cei:graphic/@url/string() return $url</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$folio-names</xrx:name>
            <xrx:expression>for $name in $image-urls return replace($name, "([^_]+)(_|-)([^_]+)(_|-)(.*)", "$5")</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$entry-as-string</xrx:name>
            <xrx:expression>serialize($entry, ())</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$atomid-linked</xrx:name>
            <xrx:expression>$entry/atom:link/@ref/string()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$is-linked</xrx:name>
            <xrx:expression>$atomid-linked != ''</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$context-linked</xrx:name>
            <xrx:expression>if($is-linked) then charter:context($atomid-linked, conf:param('atom-tag-name')) else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$uri-tokens-linked</xrx:name>
            <xrx:expression>if($is-linked) then metadata:uri-tokens($atomid-linked) else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$db-base-collection-linked</xrx:name>
            <xrx:expression>if($is-linked) then metadata:base-collection($context-linked, $uri-tokens-linked, 'public') else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$fond-entry-linked</xrx:name>
            <xrx:expression>if($is-linked) then $db-base-collection-linked//ead:ead/ancestor::atom:entry else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$fond-image-base-url-linked</xrx:name>
            <xrx:expression>if($is-linked) then concat($db-base-collection-linked/xrx:preferences/xrx:param[@name='image-server-base-url'], '/') else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$collection-entry-linked</xrx:name>
            <xrx:expression>if($is-linked) then $db-base-collection-linked//cei:cei/ancestor::atom:entry else()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$collection-image-base-url-linked</xrx:name>
            <xrx:expression>if($is-linked) then concat('http://', $collection-entry-linked//cei:image_server_address/text(), '/', $collection-entry-linked//cei:image_server_folder/text(), '/') else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$image-base-url-linked</xrx:name>
            <xrx:expression>if($context-linked = 'fond') then $fond-image-base-url-linked else $collection-image-base-url-linked</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$objectid-linked</xrx:name>
            <xrx:expression>if($is-linked) then metadata:objectid($atomid-linked) else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$base-collection-linked</xrx:name>
            <xrx:expression>if($is-linked) then metadata:base-collection('charter', $uri-tokens-linked, 'public') else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$entry-linked</xrx:name>
            <xrx:expression>if($is-linked) then $base-collection-linked//atom:id[.=$atomid-linked]/parent::atom:entry else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$image-names-linked</xrx:name>
            <xrx:expression>if($is-linked) then for $name in $entry-linked//cei:graphic/@url/string() return $name else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$image-urls-linked</xrx:name>
            <xrx:expression>if($is-linked) then for $name in $image-names-linked return concat($image-base-url-linked, $name) else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$folio-names-linked</xrx:name>
            <xrx:expression>if($is-linked) then for $name in $image-urls-linked return replace($name, "([^_]+)(_|-)([^_]+)(_|-)(.*)", "$5") else ()</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$urls</xrx:name>
            <xrx:expression>($image-urls, $image-urls-linked)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$folios</xrx:name>
            <xrx:expression>($folio-names, $folio-names-linked)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$schema</xrx:name>
            <xrx:expression>$xrx:db-base-collection/xs:schema[@id='cei']</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$xrx-schema</xrx:name>
            <xrx:expression>xsd:get('tag:www.monasterium.net,2011:/mom/xsd/cei-collection-editor')</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$attribute-suggestions</xrx:name>
            <xrx:expression>xmleditor:json-attribute-suggestions($schema)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$element-suggestions</xrx:name>
            <xrx:expression>xmleditor:json-element-suggestions($schema)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$topics</xrx:name>
            <xrx:expression>xmleditor:json-element-topics($xrx-schema)</xrx:expression>
        </xrx:variable>
        <xrx:variable>
            <xrx:name>$service-prefix</xrx:name>
            <xrx:expression>xs:string('')</xrx:expression>
        </xrx:variable>
    </xrx:variables>
    <xrx:portal>tag:www.monasterium.net,2011:/mom/portal/empty</xrx:portal>
    <xrx:init>
        <xrx:processor>
            <xrx:xformsflag>false</xrx:xformsflag>
            <xrx:jqueryflag>true</xrx:jqueryflag>
        </xrx:processor>
        <xrx:client>
            <xrx:messages>
                <xrx:catalog>cei</xrx:catalog>
            </xrx:messages>
        </xrx:client>
    </xrx:init>
    <xrx:csss>
        <xrx:css>tag:www.monasterium.net,2011:/mom/css/my-collections</xrx:css>
        <xrx:css>tag:www.monasterium.net,2011:/mom/css/image-tools</xrx:css>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/css/codemirror/lib/codemirror</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/css/codemirror/mode/visualxml</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/external/css/layout</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/external/css/imgareaselect</xrx:resource>
        <style type="text/css">

#dmy-collection-charter-edit, #dtextann, #dinner-textann{{
  position:relative;
  float:none;
  display:block;
  width:100%;
  height:100%;
}}
.xrx-layout{{
  display:block;
  position:relative;
  float:left;
  width:100%;
  height:100%;
}}
.xrx-report *{{
  font-size:0.9em;
}}
.xrx-layout .ui-layout-center, .xrx-layout .ui-layout-south, .xrx-layout .ui-layout-east, .xrx-layout .ui-layout-north{{
  padding:0; /* center-container inset will be created by an inset option */
  overflow:hidden;
}}
.dlabel {{
  font-family: Courier, monospace;
  margin-left: 2%;
  margin-top: 2%;
}}
.dlabel-text{{
  position:relative;
}}
.xrx-repeat, .CodeMirror {{
  margin-left: 2%;
}}

fieldset {{
  margin: 2%;
}}

#dviewer-switch, .xrx-case, #icharter{{
  height:100%;
}}
/*
* imageann
*/   
#dui-imageann {{ height:100%; }}
#ui-imageselect .ui-selecting {{ background: #FECA40; }}
#ui-imageselect .ui-selected {{ background: #F39814; color: white; }}
#ui-imageselect {{ list-style-type: none; margin: 0; padding: 0; }}
#ui-imageselect li {{ margin: 0px; padding: 0.4em; font-size: .7em; height: 18px; }}
#ui-imageselect .ui-widget-content {{ cursor:pointer }}
#folio-links{{
  position:absolute;
  right:0px;
  z-index:99;
  background:white;
}}
#folio-links .folio-link{{
  margin:0;
}}
#selected-folio{{
  position:absolute;
  left:0px;
  z-index:99;
  background:white;
}}
#inner-selected-folio{{
  margin:5px;
}}
#s1viewer-choice{{
  position:absolute;
  margin:10px;
  z-index:99;
  font-size:.6em;
}}
#dcharter-instance{{
  white-space:pre-wrap;
  overflow:auto !important;
}}
form{{
  margin:0;
  padding:0;
}}
/*
* table layout
*/
.table{{
  display:table;
}}
.table-row{{
  display:table-row;
}}
.table-cell{{
  width:100%;
  display:table-cell;
}}
.table-cell-value{{
  width:79%;
}}
.table-cell-label{{
  width:19%;
}}
/*
* jQuery UI
*/
.ui-tabs-anchor{{
  font-size:.8em;
}}

    </style>
    </xrx:csss>
    <xrx:jss>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/jquery</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/external/mousewheel</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/core</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/widget</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/mouse</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/draggable</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/resizable</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/selectable</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/button</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/draggable</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/droppable</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/menu</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/ui/tabs</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/external/layout</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jquery/external/imgareaselect</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/XMLFilterImpls</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/NamespaceSupport</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/AttributesImpl</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/SAXScanner</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/ReaderWrapper</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/Reader</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/sax</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/DefaultHandlers</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/jssaxparser/XPath</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/js/codemirror/lib/codemirror</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/xrx/resource/js/codemirror/mode/xml</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/js/codemirror/mode/visualxml</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/js/codemirror/keymap/visualxml</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/xrxBind</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/xrxInstance</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/xrxI18n</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrx</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxLayout</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxTabs</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxSelect1</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxMessage</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxVisualxml</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxElements</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxAttributes</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxTagname</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxReport</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/ui/xrxRepeat</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/core/resource/jquery/xrx</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/ui/imageann</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/ui/xmleditor</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/i18nText</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/imageTool</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/imageToolWidget</xrx:resource>
        <xrx:resource>tag:www.monasterium.net,2011:/mom/resource/jquery/createanno</xrx:resource>
    </xrx:jss>
    <xrx:instances>
        <xrx:instance id="icharter">{ $entry-as-string }</xrx:instance>
    </xrx:instances>
    <xrx:binds>
        <xrx:bind id="bidno" nodeset="/descendant::cei:body/child::cei:idno"/>
        <xrx:bind id="bclass" nodeset="/descendant::cei:class"/>
        <xrx:bind id="babstract" nodeset="/descendant::cei:abstract"/>
        <xrx:bind id="bissued-date-range" nodeset="/descendant::cei:issued/child::cei:dateRange"/>
        <xrx:bind id="bissued-place" nodeset="/descendant::cei:issued/child::cei:placeName"/>
        <xrx:bind id="btenor" nodeset="/descendant::cei:body/child::cei:tenor"/>
        <xrx:bind id="bsource-desc-tenor" nodeset="/descendant::cei:sourceDescVolltext"/>
        <xrx:bind id="bsource-desc-abstract" nodeset="/descendant::cei:sourceDescRegest"/>
        <xrx:bind id="borig" nodeset="/descendant::cei:witnessOrig"/>
        <xrx:bind id="borig-traditio-form" nodeset="/descendant::cei:witnessOrig/child::cei:traditioForm"/>
        <xrx:bind id="borig-figure" nodeset="/descendant::cei:witnessOrig/child::cei:figure"/>
        <xrx:bind id="borig-arch-identifier" nodeset="/descendant::cei:witnessOrig/child::cei:archIdentifier"/>
        <xrx:bind id="borig-material" nodeset="/descendant::cei:witnessOrig/child::cei:physicalDesc/child::cei:material"/>
        <xrx:bind id="borig-decodesc" nodeset="/descendant::cei:witnessOrig/child::cei:physicalDesc/child::cei:decoDesc"/>
        <xrx:bind id="borig-dimensions" nodeset="/descendant::cei:witnessOrig/child::cei:physicalDesc/child::cei:dimensions"/>
        <xrx:bind id="borig-condition" nodeset="/descendant::cei:witnessOrig/child::cei:physicalDesc/child::cei:condition"/>
        <xrx:bind id="borig-auth" nodeset="/descendant::cei:witnessOrig/child::cei:auth"/>
        <xrx:bind id="borig-seal-desc" nodeset="/descendant::cei:witnessOrig/descendant::cei:sealDesc"/>
        <xrx:bind id="borig-notarius-desc" nodeset="/descendant::cei:witnessOrig/descendant::cei:notariusDesc"/>
        <xrx:bind id="bpar" nodeset="/descendant::cei:witListPar/child::cei:witness"/>
        <xrx:bind id="bpar-traditio-form" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:traditioForm"/>
        <xrx:bind id="bpar-figure" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:figure"/>
        <xrx:bind id="bpar-arch-identifier" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:archIdentifier"/>
        <xrx:bind id="bpar-material" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:physicalDesc/child::cei:material"/>
        <xrx:bind id="bpar-dimensions" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:physicalDesc/child::cei:dimensions"/>
        <xrx:bind id="bpar-condition" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:physicalDesc/child::cei:condition"/>
        <xrx:bind id="bpar-auth" nodeset="/descendant::cei:witListPar/child::cei:witness/child::cei:auth"/>
        <xrx:bind id="bpar-seal-desc" nodeset="/descendant::cei:witListPar/child::cei:witness/descendant::cei:sealDesc"/>
        <xrx:bind id="bpar-notarius-desc" nodeset="/descendant::cei:witListPar/child::cei:witness/descendant::cei:notariusDesc"/>
        <xrx:bind id="bdiplomaticAnalysis" nodeset="/descendant::cei:diplomaticAnalysis"/>
        <xrx:bind id="blistBibl" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:listBibl"/>
        <xrx:bind id="blistBiblEdition" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:listBiblEdition"/>
        <xrx:bind id="blistBiblRegest" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:listBiblRegest"/>
        <xrx:bind id="blistBiblFaksimile" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:listBiblFaksimile"/>
        <xrx:bind id="blistBiblErw" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:listBiblErw"/>
        <xrx:bind id="bquoteOriginaldatierung" nodeset="/descendant::cei:diplomaticAnalysis/child::cei:quoteOriginaldatierung"/>
        <xrx:bind id="bdiv-notes" nodeset="/descendant::cei:back/child::cei:divNotes"/>
        <xrx:bind id="blang-mom" nodeset="/descendant::cei:lang_MOM"/>
        <xrx:bind id="bback" nodeset="/descendant::cei:back"/>
    </xrx:binds>
    <xrx:view>
        <div data-demoid="393de52d-1b4f-4df8-99b1-e7af26b713fe" id="dmy-collection-charter-edit">
            <xrx:layout>
                <xrx:options>
                    <xrx:option key="north__resizable">false</xrx:option>
                    <xrx:option key="south__size">.5</xrx:option>
                </xrx:options>
                <xrx:center>
                   <xrx:auth>
                        <xrx:rules>
                            <xrx:rule>
                                <xrx:user/>
                                <xrx:dbgroup>atom</xrx:dbgroup>
                            </xrx:rule>
                        </xrx:rules>
                        <xrx:true>
                            <div data-demoid="09a18129-a5e4-42f7-ab9e-1d4bcf9497bb" id="dui-imageann">
                                <script type="text/javascript">
                $(document).ready(function(){{
                  jQuery(document).imageTool({{
                    requestRoot: "{ conf:param('request-root') }",
                    charter: "{ $uuid }",
                    collection: "",
                    scope: "private",
                    servicePrefix: "{ $service-prefix }"
                  }});
                  jQuery(document).i18nText({{
                    lang: "{ $xrx:lang }",
                    requestRoot: "{ conf:param('request-root') }"
                  }});
                  jQuery("input", "#s1viewer-choice").change(function(){{
                      if ($(this).is(':checked')) {{
                          var caseDiv = $(this).val();
                          $(".xrx-case", "#dviewer-switch").hide();
                          $("#"+ caseDiv, "#dviewer-switch").show();
                      }}
                  }});
                  
                }});     
                </script>
                                <xrx:select1 appearance="xrx-appearance-buttonset" id="s1viewer-choice">
                                    <xrx:item>
                                        <xrx:label>
                                            <xrx:i18n>
                                                <xrx:key>graphics</xrx:key>
                                                <xrx:default>Graphics</xrx:default>
                                            </xrx:i18n>
                                        </xrx:label>
                                        <xrx:value>ui-imageann-wrapper</xrx:value>
                                    </xrx:item>
                                    <xrx:item>
                                        <xrx:label>
                                            <xrx:i18n>
                                                <xrx:key>xml</xrx:key>
                                                <xrx:default>XML</xrx:default>
                                            </xrx:i18n>
                                        </xrx:label>
                                        <xrx:value>dcharter-instance</xrx:value>                                        
                                    </xrx:item>
                                    
                                </xrx:select1>
                                <xrx:switch id="dviewer-switch">
                                    <xrx:case id="ui-imageann-wrapper">
                                        <div data-demoid="a4fa4172-275b-4337-8a83-15f398663e76" id="selected-folio">
                                            <span id="select-result"/>
                                        </div>
                                        <div data-demoid="b90a2b1c-9164-49b9-a8cb-f47f1413947c" id="folio-links">
                                            <ol id="ui-imageselect">
                        {
                        for $folio at $p in $folios
                        return
                        <li title="{ $urls[$p] }">{ if($p = 1) then attribute class { 'ui-widget-content ui-selected' } else attribute class { 'ui-widget-content' } }{ $folio }</li>
                        }
                      </ol>
                                        </div>
                                        <div data-demoid="f224f11c-46c7-41b3-839d-02eb5f9e278a" id="ui-imageann" style="width:100%;height:100%;position:relative;overflow:hidden;">
                                            <div data-demoid="5c720e82-758a-4e64-9b13-a6295c9e833c">
                                                <div data-demoid="f1542ed4-df27-4ddb-bb3a-46c629f63f2c" id="img-svg"/>
                                                <div data-demoid="0bff0a22-184d-49c8-84bb-3e8eaf390028" id="img-img">
                                                    <img alt="image" class="zoomable" id="img" src="{ if($urls[1] = '' or not($urls[1])) then 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' else $urls[1] }" style="z-index:1;position:absolute;"/>
                                                </div>
                                            </div>
                                        </div>
                                    </xrx:case>
                                    <xrx:case id="dpreview">
                                        <span>Preview</span>
                                    </xrx:case>
                                    <xrx:case id="dcharter-instance"/>
                                </xrx:switch>
                            </div>
                            
                        </xrx:true>
                        <xrx:false>
                            <div data-demoid="de9f813e-6b5d-49f6-91b3-eee1a1731a7b"/>
                        </xrx:false>
                    </xrx:auth>
                </xrx:center>
                <xrx:north>
                    <div data-demoid="48d984c8-63e8-48df-95bc-00ad1e2b62c5" id="dmy-collection-header">
                    <!-- Testzone -->  
                  
                    
                    
                    <!-- Testzone ende -->
                        <h2>EditILLURK</h2>
                        <div data-demoid="4c56fbe3-1728-47c6-af7e-ab39fb266752" id="autoSaveStatus"/>
                    </div>
                    <div data-demoid="4e751e31-7e32-42cd-96a3-ce571b5ea97a" id="image-tool-div">
                        <button id="open-image-tool">
                            <xrx:i18n>
                                <xrx:key>open-image-tools</xrx:key>
                                <xrx:default>Open Image Tools</xrx:default>
                            </xrx:i18n>
                        </button>
                    </div>
                </xrx:north>
                <xrx:south id="dtextann">
                    <xrx:auth>
                        <xrx:rules>
                            <xrx:rule>
                                <xrx:user/>
                                <xrx:dbgroup>atom</xrx:dbgroup>
                            </xrx:rule>
                        </xrx:rules>
                        <xrx:true>
                            <div data-demoid="d6062366-8073-43c1-9472-4667e1c44c95" id="dinner-textann">
                                <xrx:layout>
                                    <xrx:options>
                                        <xrx:option key="east__size">.3</xrx:option>
                                    </xrx:options>
                                    <xrx:center>
                                        <div class="xrx-layout" data-demoid="bd089740-6647-48f3-9042-544ae9d31cae" onclick="return {{ north__resizable: false, north__showOverflowOnHover: true }}">
                                            <div class="ui-layout-center xrx-tabs" data-demoid="086ae85e-889f-4d7e-b2cd-3e19bd63819f" style="overflow:auto;">
                                                <ul>
                                                    <li>
                                                        <a class="anchor" href="#tab-1">
                                                            <xrx:i18n>
                                                                <xrx:key>abstract</xrx:key>
                                                                <xrx:default>abstract</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="anchor" href="#tab-2">
                                                            <xrx:i18n>
                                                                <xrx:key>decoDesc</xrx:key>
                                                                <xrx:default>Kunsthistorische Beschreibung</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="anchor" href="#tab-3">
                                                            <xrx:i18n>
                                                                <xrx:key>source</xrx:key>
                                                                <xrx:default>Archiv</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="anchor" href="#tab-6">
                                                            <xrx:i18n>
                                                                <xrx:key>bibliography</xrx:key>
                                                                <xrx:default>Bibliography</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="anchor" href="#tab-4">
                                                            <xrx:i18n>
                                                                <xrx:key>commentary</xrx:key>
                                                                <xrx:default>commentary</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="anchor" href="#tab-5">
                                                            <xrx:i18n>
                                                                <xrx:key>appendix</xrx:key>
                                                                <xrx:default>appendix</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                </ul>
                                                <div data-demoid="c0ca5834-6e65-4b0a-bd53-c1ecdfd5ee2f" id="tab-1">
                                                    <div class="dlabel" data-demoid="492ee53d-cb5c-4094-8aea-84e164ac761a">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_idno</xrx:key>
                                                                <xrx:default>signature</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <div data-demoid="26331a1b-46ff-40f0-b0d0-5208019bc30a">
                                                        <xrx:visualxml attributes="no" bind="bidno" elements="no"/>
                                                    </div>                                                  
                                                    
                                                    
                                                    <div class="dlabel" data-demoid="edda0ecf-9b46-4d62-b895-dcfac04070a6">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_abstract</xrx:key>
                                                                <xrx:default>Abstract</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <div data-demoid="3a7e9ec9-dec0-43ba-afdc-1a5b1e2fef75">
                                                        <xrx:visualxml bind="babstract"/>
                                                    </div>
                                                    <div class="dlabel table" data-demoid="46b5acdb-e19d-4b96-930e-c0671e7a3f71">
                                                        <div class="table-row" data-demoid="b3ee9a26-774f-45c2-b326-64ed3b30a6ea">
                                                            <div class="table-cell table-cell-label dlabel" data-demoid="c228daea-a504-4b6a-b9f3-c050f73e83f4">
                                                                <xrx:i18n>
                                                                    <xrx:key>issuedDate</xrx:key>
                                                                    <xrx:default>Date when issued</xrx:default>
                                                                </xrx:i18n>
                                                                <span>:</span>
                                                            </div>
                                                            <div class="table-cell table-cell-value" data-demoid="e41beeb2-653d-4682-9ec7-6c6a8f0a7d5d">
                                                                <xrx:visualxml bind="bissued-date-range"/>
                                                            </div>
                                                        </div>
                                                        <div class="table-row" data-demoid="d261c9c2-da7b-475c-b97e-1d498236263d">
                                                            <div class="table-cell table-cell-label dlabel" data-demoid="0c1f11ff-d54b-4cbc-9715-54035f881413">
                                                                <xrx:i18n>
                                                                    <xrx:key>issuedPlaceName</xrx:key>
                                                                    <xrx:default>Place where issued</xrx:default>
                                                                </xrx:i18n>
                                                                <span>:</span>
                                                            </div>
                                                            <div class="table-cell table-cell-value" data-demoid="c77e6c37-36bb-4f6b-91fc-12cabe532821">
                                                                <xrx:visualxml bind="bissued-place"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div data-demoid="92749a8b-b697-4f54-8cc4-21a54bca510f" id="tab-2">
                                                    
                                                    <div class="dlabel">
                                                        <span class="dlabel-text" style="display:none;">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_p</xrx:key>
                                                                <xrx:default>comment</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div> 
                                                    <xrx:repeat bind="borig-decodesc">
                                                        <xrx:visualxml ref="/child::cei:p"/>
                                                    </xrx:repeat>                                                  
                                                </div>
                                                <div data-demoid="85cbe1bb-7c1c-4cde-9fff-48db5bb01569" id="tab-3">
                                                    <div class="dlabel" data-demoid="f4df2562-ad75-42fd-8471-435a42352cf4">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_archIdentifier</xrx:key>
                                                                <xrx:default>archival identification</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:visualxml bind="borig-arch-identifier"/>
                                                    <div class="dlabel" data-demoid="a5850edf-bbf8-45b6-8aeb-919c55c24904">
                                                        <xrx:i18n>
                                                            <xrx:key>graphics</xrx:key>
                                                            <xrx:default>graphics</xrx:default>
                                                        </xrx:i18n>
                                                    </div>
                                                    <xrx:repeat bind="borig">
                                                        <xrx:visualxml ref="/child::cei:figure"/>
                                                    </xrx:repeat>
                                                </div>
                                                <div data-demoid="819ee757-c834-49f2-a696-1a4e133055ac" id="tab-6">
                                                    <div class="dlabel" data-demoid="b760a8b1-daba-41df-9696-6bbc8199b458">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_listBibl</xrx:key>
                                                                <xrx:default>bibliography</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="blistBibl">
                                                        <xrx:visualxml attributes="no" elements="no" ref="/child::cei:bibl"/>
                                                    </xrx:repeat>
                                                    <div class="dlabel" data-demoid="d951f077-bd8e-407a-9835-ced01caf67e0">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_listBiblEdition</xrx:key>
                                                                <xrx:default>edition</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="blistBiblEdition">
                                                        <xrx:visualxml attributes="no" elements="no" ref="/child::cei:bibl"/>
                                                    </xrx:repeat>
                                                    <div class="dlabel" data-demoid="07146224-e2e7-4e79-99b2-390d867bb803">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_listBiblFaksimile</xrx:key>
                                                                <xrx:default>facsimile</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="blistBiblFaksimile">
                                                        <xrx:visualxml attributes="no" elements="no" ref="/child::cei:bibl"/>
                                                    </xrx:repeat>
                                                    <div class="dlabel" data-demoid="80ef82ba-dc3e-4598-a83d-d1c9e5ca8aec">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_listBiblErw</xrx:key>
                                                                <xrx:default>secondary literature</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="blistBiblErw">
                                                        <xrx:visualxml attributes="no" elements="no" ref="/child::cei:bibl"/>
                                                    </xrx:repeat>
                                                </div>
                                                <div data-demoid="819ee757-c834-49f2-a696-1a4e133055ac" id="tab-4">
                                                    <div class="dlabel" data-demoid="d97c0f16-1d58-4a6c-83e9-a89dd48d58ef">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_p</xrx:key>
                                                                <xrx:default>comment</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="bdiplomaticAnalysis">
                                                        <xrx:visualxml ref="/child::cei:p"/>
                                                    </xrx:repeat>
                                                </div>
                                                <div data-demoid="c46aa058-3b4d-48eb-958a-905652a5754b" id="tab-5">
                                                    <div class="dlabel" data-demoid="66e9dcdc-86b7-4a0b-a393-fdc46378b557">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_placeName</xrx:key>
                                                                <xrx:default>place name</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <xrx:repeat bind="bback">
                                                        <xrx:visualxml ref="/child::cei:placeName"/>
                                                    </xrx:repeat>
                                                 <!--  <div class="dlabel">
                                                        <span class="dlabel-text">
                                                            <xrx:i18n>
                                                                <xrx:key>cei_class</xrx:key>
                                                                <xrx:default>Urkundenart</xrx:default>
                                                            </xrx:i18n>
                                                        </span>
                                                    </div>
                                                    <div>
                                                        <xrx:visualxml attributes="no" bind="bclass" elements="no"/>
                                                    </div>--> 
                                                </div>
                                            </div>
                                            <div class="ui-layout-north" data-demoid="5da89345-2191-497a-98de-b895609836b1">
                                                <div class="dmy-collection-toolbar" data-demoid="f007ba43-bb97-4d77-b520-d58fe71674e7">
                                                    <xrx:elements/>
                                                    <span style="font-size:1.6em;">&#160;</span>
                                                </div>
                                            </div>
                                        </div>
                                    </xrx:center>
                                    <xrx:east>
                                        <div class="xrx-layout" data-demoid="10237aca-70ac-46c7-baf6-eb371153610b" onclick="return {{ north__resizable: false }}">
                                            <div class="ui-layout-center xrx-tabs" data-demoid="1fbb416a-875f-4730-8ff8-2738bc087545">
                                                <ul>
                                                    <li>
                                                        <a href="#atab-1">
                                                            <xrx:i18n>
                                                                <xrx:key>attributes</xrx:key>
                                                                <xrx:default>Attributes</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#atab-2" id="tab-validation-report">
                                                            <xrx:i18n>
                                                                <xrx:key>validation-report</xrx:key>
                                                                <xrx:default>Validation Report</xrx:default>
                                                            </xrx:i18n>
                                                        </a>
                                                    </li>
                                                </ul>
                                                <div data-demoid="aa7f3e52-4827-4461-b9c6-1b45d6634e8d" id="atab-1">
                                                    <xrx:attributes/>
                                                </div>
                                                <div data-demoid="a4b8cd5f-f77c-417f-a681-383d0d419a45" id="atab-2">
                                                    <div class="xrx-report" data-demoid="2e057ed2-f72f-4e57-82b8-59c2cdb7a89e"/>
                                                </div>
                                            </div>
                                            <div class="ui-layout-north" data-demoid="09c01686-e6d0-4ae7-bfa3-4692484cfac5">
                                                <div class="dmy-collection-toolbar" data-demoid="d77ece62-d2ce-4928-b045-5ad66686e512">
                                                    <xrx:tagname>&#160;</xrx:tagname>
                                                </div>
                                            </div>
                                        </div>
                                    </xrx:east>
                                </xrx:layout>
                            </div>
                        </xrx:true>
                        <xrx:false>
                            <div data-demoid="b96fe135-5335-414b-8dfc-5836cd60aaff" id="dlogin">
                                <xrx:i18n>
                                    <xrx:key>protected-page-message</xrx:key>
                                    <xrx:default>Protected page. Please login first.</xrx:default>
                                </xrx:i18n>
                                <xrx:subwidget>tag:www.monasterium.net,2011:/mom/widget/login2</xrx:subwidget>
                            </div>
                        </xrx:false>
                    </xrx:auth>
                </xrx:south>
            </xrx:layout>
            <div data-demoid="255993c7-4e5d-4a9b-90b3-beec82724ac7" id="image-tool-widget">
                <xrx:resource id="image-tool-widget-close-button" title="Close Image Tool" type="image/png">tag:www.monasterium.net,2011:/mom/resource/image/button_close</xrx:resource>
                <div data-demoid="9540bf3f-0242-4de2-9ba0-5359d2224809" id="image-tool-widget-button-bar">
                    <button class="image-tool-widget-button" id="create-new-anno-button">
                        <xrx:i18n>
                            <xrx:key>create-new</xrx:key>
                            <xrx:default>Create new</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="save-selection-button">
                        <xrx:i18n>
                            <xrx:key>save-selection</xrx:key>
                            <xrx:default>Save selection</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="edit-anno-button">
                        <xrx:i18n>
                            <xrx:key>edit-annotation</xrx:key>
                            <xrx:default>Edit annotation</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="delete-anno-button">
                        <xrx:i18n>
                            <xrx:key>delete-annotation</xrx:key>
                            <xrx:default>Delete annotation</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="add-metadata-button">
                        <xrx:i18n>
                            <xrx:key>add-metadata</xrx:key>
                            <xrx:default>Add metadata</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="save-metadata-button">
                        <xrx:i18n>
                            <xrx:key>save-metadata</xrx:key>
                            <xrx:default>Save metadata</xrx:default>
                        </xrx:i18n>
                    </button>
                    <button class="image-tool-widget-button" id="show-anno-button">
                        <xrx:i18n>
                            <xrx:key>show-annotation</xrx:key>
                            <xrx:default>Show annotation</xrx:default>
                        </xrx:i18n>
                    </button>
                </div>
                <div data-demoid="0117de43-721b-46bb-84a3-18025d685f5c" id="image-tool-widget-metadata-area">
                    <div data-demoid="8aeb9681-8d6f-47e7-8c0b-56fc79cfc5a3" id="drop-area">
                        <div class="inactive-drop-annotation" data-demoid="b9b37ec7-8611-48f9-9e86-d08a36593590" id="drop-annotation-markup-tag">
                            <span>
                                <xrx:i18n>
                                    <xrx:key>drop-here</xrx:key>
                                    <xrx:default>Drop here</xrx:default>
                                </xrx:i18n>
                            </span>
                        </div>
                    </div>
                    <div data-demoid="24b30514-d664-4f20-9b43-6ac97b31c97e" id="create-metadata-field">
                        <span class="meta-caption" style="float:left;">
                            <xrx:i18n>
                                <xrx:key>selected-tag</xrx:key>
                                <xrx:default>Selected Tag</xrx:default>
                            </xrx:i18n>:&#160;&#160;</span>
                        <span id="selected-tag"/>
                        <span class="ui-icon ui-icon-trash" id="tag-to-trash"/>
                        <br/>
                        <span class="meta-caption">
                            <xrx:i18n>
                                <xrx:key>additional-description</xrx:key>
                                <xrx:default>Additional Description</xrx:default>
                            </xrx:i18n>:
            </span>
                        <br/>
                        <textarea id="zone-description"/>
                    </div>
                    <div data-demoid="eebbbebf-df78-439b-aa84-81c18f39ae69" id="metadata-field">
                        <span class="meta-caption">
                            <xrx:i18n>
                                <xrx:key>related-to</xrx:key>
                                <xrx:default>Related to</xrx:default>
                            </xrx:i18n>:
            </span>
                        <a href="#" id="related-to"/>
                        <br/>
                        <span class="meta-caption">
                            <xrx:i18n>
                                <xrx:key>content</xrx:key>
                                <xrx:default>Content</xrx:default>
                            </xrx:i18n>:
            </span>
                        <span id="anno-content"/>
                        <br/>
                        <span class="meta-caption">
                            <xrx:i18n>
                                <xrx:key>additional-description</xrx:key>
                                <xrx:default>Additional Description</xrx:default>
                            </xrx:i18n>:
            </span>
                        <br/>
                        <div data-demoid="fc4097e7-f191-4a95-b763-c3bfc40fd29a" id="anno-desc"/>
                    </div>
                </div>
            </div>
            <div class="xrx-message" data-demoid="aa0e9f99-53e1-4893-9290-2cf835e1c3ca"/>
            <div class="xrx-forms-json-attribute-suggestions" data-demoid="a9a1b205-f185-4e4c-8fcc-8d1a397c881e" style="display:none">{ $attribute-suggestions }</div>
            <div class="xrx-forms-json-element-suggestions" data-demoid="90164e9b-8793-4426-9cb3-9c91b1252326" style="display:none">{ $element-suggestions }</div>
            <div class="xrx-forms-json-topics" data-demoid="29dc1908-0c8d-4501-ab7d-5e0cbdc492b9" style="display:none">{ $topics }</div>
            <script type="text/javascript">
      jQuery(document).ready(function(){{ 
        jQuery.ajaxSetup({{ cache: false }});
        window.XPath = new XPath();
        window.XPath.setNamespaceContext(
            ["atom", "cei"],
            ["http://www.w3.org/2005/Atom", "http://www.monasterium.net/NS/cei"]
            );
        jQuery(document).xmleditor({{
          requestRoot: "{ conf:param('request-root') }"
        }});
        jQuery("#icharter").appendTo("#dcharter-instance").show();
        jQuery(".anchor", "#dinner-textann").click(function() {{
          $(".xrx-visualxml").each(function(){{ $(this).xrxVisualxml("clear"); }});
        }});
       // hier wird in ein div der Wert 0 eingetrage, sobald das Dok geladen ist.
        var sperre = document.getElementById("sperrzone");
        sperre.innerHTML = "0";
        
      }});
      
      </script>
        </div>
    </xrx:view>
</xrx:widget>